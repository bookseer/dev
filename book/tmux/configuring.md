---
jupytext:
  text_representation:
    extension: .md
    format_name: myst
kernelspec:
  display_name: Python 3
  language: python
  name: python3
---

(tmux_configuring)=
# Настройка tmux

Сейчас, уже имея некоторый опыт работы с tmux, давайте создадим собственную конфигурацию, которую сможем использовать
для наших остальных рабочих задач.

tmux по умолчанию имеет не самые удобные настройки.
Многие из наиболее важных и полезных функции назначаются труднодоступным сочетаниям клавиш или состоят из длинных многословных команд.
Например, {bdg-dark}`PREFIX` трудно нажимать, поскольку для этого требуется удерживать две клавиши, многие сочетания клавиш труднзапоминаемы, а цветовая схема tmux по умолчанию не особенно приятна для глаз.
В этом разделе мы создадим базовый конфигурационный файл, который затем будем использовать в оставшейся части руководства.
После изучения данного материала, у вас будет лучшее представление о том, насколько гибок tmux, и вы сможете конфигурировать его самостоятельно.
Давайте начнем с разговора о том, что нужно настроить в tmux в первую очередь.

+++

## Файл .tmux.conf

По умолчанию tmux ищет параметры конфигурации в двух местах.
Сначала в **/etc/tmux.conf** он ищет общесистемную конфигурацию.
Затем --- файл с именем **.tmux.conf** в домашнем каталоге текущего пользователя.
Если эти файлы не существуют, tmux просто использует настройки по умолчанию.
Нам не нужно создавать общесистемный файл конфигурации, поэтому давайте создадим пустой файл конфигурации в нашем домашнем каталоге.
Для этого можно использовать следующую команду:
```console
$ touch ~/.tmux.conf
```

В этом файле мы можем делать все, от определения новых сочетаний клавиш до настройки окружения по умолчанию с нескольими окнами, панелями и запущенными программами.
Давайте начнем с установки нескольких основных параметров, которые сделают работу с tmux намного проще.

:::{note}
Файл .tmux.conf является скрытым и не отображается в файловых менеджерах или списках каталогов по умолчанию.
:::

+++

## Назначение более простого префикса
tmux использует {bdg-dark}`Ctrl`-{bdg-dark}`b` в качестве префикса команд.
Многие пользователи tmux начинали с GNUScreen, который использует {bdg-dark}`Ctrl`-{bdg-dark}`a` для префикса команд.
{bdg-dark}`Ctrl` --- отличный выбор для префикса, потому что легко доступен, особенно если переназначить клавишу {bdg-dark}`Caps Lock` на {bdg-dark}`Ctrl`, как описано на далее.
Это позволит для большинства действий не убирать руки с центрального ряда клавиатуры.

:::{note}
**Переназначение клавиши `Caps Lock`**
На многих клавиатурах клавиша {bdg-dark}`Caps Lock` находится рядом с клавишей {bdg-dark}`a` в центральном ряду клавиатуры.
Переназначив эту клавишу на {bdg-dark}`Ctrl`, можно сделать запуск команд более удобным.
На Mac переназначить клавишу {bdg-dark}`Caps Lock` можно в панели настроек клавиатуры в разделе «Системные настройки». Просто нажмите кнопку «Клавиши-модификаторы» и измените действие для {bdg-dark}`Caps Lock` на «Control».

Под Linux этот процесс может быть немного сложнее в зависимости от используемого дистрибутива или оконного менеджера, но можете найти несколько способов, [в вики Emacs](http://www.emacswiki.org/emacs/MovingTheCtrlKey).
Это небольшое изменение в конфигурации может сэкономить удивительное количество времени в течение дня.
:::

Чтобы установить параметры в файле .tmux.conf, используется команда `set-option`, которую можно сократить до `set`.
Для переопределения префикса tmux, нужно добавить в файл .tmux.conf следующие строки:
```
# .tmux.conf

# Setting the prefix from C-b to C-a
set -g prefix C-a
```

В этом примере используется параметр `-g` «глобально», который устанавливает параметр для всех создаваемых сеансов tmux.
Строка, начинающаяся с `#`, является комментарием.
Рекомендуется оставлять комментарии в конфигурационных файлах, так как они помогут вспомнить значения настроек, когда вы вернетесь и посмотрите на свою конфигурацию через несколько месяцев.
Комментарии в файле конфигурации tmux работают так же, как комментарии в исходном коде.

Хотя, в данном случае, в этом нет необходимости, можно использовать `unbind-key` или команду `unbind`, чтобы удалить привязку клавиш, которая была определена до этого, чтобы позже назначить другую команду этой клавише.
Освободим {bdg-dark}`Ctrl`-{bdg-dark}`b` вот так:
```
# .tmux.conf

# Free the original Ctrl-b prefix keybinding
unbind C-b
```

:::{note}
Изменения в файле не считываются tmux автоматически.
Поэтому, если редактировать файл .tmux.conf когда tmux запущен, необходимо либо полностью закрыть все сеансы tmux, либо войти в командный режим tmux с помощью {bdg-dark}`PREFIX` {bdg-dark}`:` и ввести:
```tmux
: source-file ~/.tmux.conf
```
:::
Теперь можно использовать {bdg-dark}`Ctrl`-{bdg-dark}`a` в качестве префикса.
Остальные примеры в этом руководстве будут по-прежнему ссылаться на него как на {bdg-dark}`PREFIX`.

+++

## Изменение задержки по умолчанию
tmux добавляет очень небольшую задержку при отправке команд, и эта задержка может мешать другим программам, например, текстовому редактору Vim.
Устранить эту проблему, можно добавив в конфигурационный файл следующее определение:
```
# .tmux.conf

# Setting the delay between prefix and command
set -s escape-time 1
```
После перезагрузки файла конфигурации, можно будет без задержки нажимать клавиши.

+++

## Настройка индексации окон и панелей
В разделе {ref}`«Основы tmux» <tmux_basic>` было рассказано об окнах и о том, как при создании нескольких окон в сеансе, можно ссылаться на них по индексу. Индексация начинается с нуля, что немного неудобно, так как придодится использовать {bdg-dark}`PREFIX` {bdg-dark}`0` для доступа к первому окну.

Добавив эту строку в файл конфигурации
```
# .tmux.conf

# Set the base index for windows to 1 instead of 0
set -g base-index 1
```
установим индексацию окон с 1.
После этого, для доступа к первому окну можно будет использовать {bdg-dark}`PREFIX` {bdg-dark}`1`.
Это проще и понятнее, так как клавиши на клавиатуре теперь напрямую соответствуют окнам, перечисленным в строке состояния.

Аналогично установим начальный индекс для панелей, используя опцию `pane-base-index`, чтобы у вас была согласованность между нумерацией панелей и окон.
```
# .tmux.conf

# Set the base index for panes to 1 instead of 0
setw -g pane-base-index 1
```

До сих пор использовалась команда `set`, которая устанавливает параметры для сеанса tmux.
Чтобы настроить параметры, которые влияют на взаимодействие с окнами, необходимо использовать другую команду --- `set-windowoption`, или ее сокращенный вариант `setw`.
Сокращенные версии команд удобны тем, что примеры конфигурации помещающимися в одну строку.

Теперь давайте создадим несколько полезных сочетаний клавиш, которые повысят вашу продуктивность.

+++

### Назначение сочетания клавиш для перезагрузки конфигурации

Каждый раз, когда при внесении изменений в файл конфигурации, нужно либо закрыть все сеансы и перезапустить tmux, либо
ввести команду
```tmux
: source
```
чтобы перезагрузить конфигурацию непосредственно из запущенного сеанса tmux.
Давайте создадим клавиатурную команду для перезагрузки файла конфигурации.

Определяет новую клавиатурную привязку команда `bind`.
При этом необходимо указывать клавишу, которая будет использоваться, а затем команду, запуск которой необходимо
привязать к этой клавише.

Давайте определим {bdg-dark}`PREFIX` {bdg-dark}`r`, чтобы перезагружать файл .tmux.conf в текущем сеансе.
Для этого добавьте эту строку в свой конфигурационный файл:
```
.tmux.conf

# Reload the configuration file with Prefix r
bind r source-file ~/.tmux.conf
```
С помощью этой привязки клавиш можно внести изменения в файл конфигурации, а затем немедленно активировать их,
нажав  {bdg-dark}`PREFIX`  {bdg-dark}`r`.
Однако данной командой все щеще нельзя будет воспользоваться, пока не будет перезагружен файл конфигурации вручную.
Для этого нужно войти в командный режим с помощью {bdg-dark}`PREFIX` {bdg-dark}`:` и ввести
```tmux
: source-file ~/.tmux.conf
```

При перезагрузке файла конфигурации, не всегда можно понять, что что-то изменилось.
Сделать этот процесс более наглядным, можно при помощи команды `display`, которая добавит сообщение в строку состояния.
Измените команду перезагрузки, чтобы отобразить текст «Reloaded!» при загрузке файла конфигурации:
```
.tmux.conf

# Reload the configuration file with Prefix r
bind r source-file ~/.tmux.conf \; display "Reloaded!"
```
Как видите, можно привязать клавишу к последовательности команд, разделив команды комбинацией `\;`.

+++

## Определение сочетаний клавиш, не требующих префикса

Когда определяются привязки клавиш с помощью `bind`, все равно нужно нажать клавиши составляющие {bdg-dark}`PREFIX`,
прежде чем можно будет нажать вновь определенную клавишу.

Использование команды `bind` с префиксом `-n` сообщает tmux, что привязка клавиш не требует нажатия префикса.
Например, настройка
```
~/.tmux.conf

bind-key -n C-r source-file ~/.tmux.conf
```
заставит {bdg-dark}`CTRL`-{bdg-dark}`r` перезагрузить файл конфигурации.
К сожалению, это переопределит эту комбинацию клавиш в любом приложении, которое работает в сеансе tmux, поэтому
следует пользоваться такой возможностью с большой осторожностью.
