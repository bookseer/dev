---
jupytext:
  text_representation:
    extension: .md
    format_name: myst
kernelspec:
  display_name: Python 3
  language: python
  name: python3
---

(tmux_basic)=
# Основы tmux

+++

Теперь, когда tmux установлен, рассмотрим основные его функции, начав с базового сеанса.

+++

## Запуск tmux

Самый простой способ запуска tmux --- ввести в терминале:
```console
$ tmux
```

После этого окно терминала станет похоже на следующее изображение
:::{figure-md} tmux_basic_010
<img src="./images/tmux_basic_010.svg" alt="Сеанс tmux по умолчанию">

Сеанс tmux по умолчанию
:::

Это «сеанс» (session) tmux, и он работает так же, как обычный терминальный сеанс.
Можно ввести любую допустимую команду, и все будет работать, как ожидалось.

Чтобы закрыть сеанс tmux, нужно ввести
```console
$ exit
```
в самом сеансе.
Это приведет к закрытию tmux, и возврату к стандартному терминалу.

Однако, такой способ запуска tmux не очень удобен для продолжительной работы, и годится лишь для кратковременных сеансов.
Если использовать tmux сколь-нибудь продолжительное время, лучше создать «именованные сеансы».
Такой способ позволит легко идентифицировать сеансы, и свободно переключаться между ними в процессе работы.

Таким образом, можно запускать на одном компьютере столько, сколько необходимо, и при желании организовывать их
по своему усмотрению.
Например, один сеанс для рабочего проекта, другой --- для собственного крутого сайд-проекта.
Можно организовать эти сеансы, давая каждому собственное уникальное имя.
Это очень просто.
Следующая команда создаст именованный сеанс под названием «base»:
```console
$ tmux new-session -s base
```
Более короткий вариант этой команды выглядит так:
```console
$ tmux new -s base
```

Запуск любой из этих команд приведет к запуску «именованного сеанса» tmux.
:::{figure-md} tmux_basic_020
<img src="./images/tmux_basic_020.svg" alt="Именованный сеанс base">

Именованный сеанс base
:::

Заметить различия, однако, по сравнению с предыдущим запуском, довольно сложно.
Единственное различие --- это имя сеанса в нижнем левом углу окна терминала.

Именованные сеансы удобны, когда есть необходимость оставлять tmux запущенным в фоне.

Особенности работы с сеансами tmux и способы запуска программ в фоновом режиме рассматриваются далее.
А сейчас поговорим о том, как отправлять команды в tmux.

+++

## Префикс команд

Поскольку консольные приложения выполняются внутри tmux, становиться необходим способ сообщить tmux, что команда,
вводимая команда предназначена для него, а не для основного приложения.
Это делается с помощью комбинации клавиш {bdg-dark}`Ctrl`-{bdg-dark}`b`, которая называется *префиксом команд*.
Для ввода любой команды tmux необходимо предварительно использовать эту комбинацию.
Важно отметить, что не следует удерживать все клавиши вместе.
Вместо этого сначала одновременно нажмите {bdg-dark}`Ctrl`-{bdg-dark}`b`, отпустите эти клавиши, а затем сразу же
нажмите клавишу связанную с командой, которую вы хотите передать tmux.

Чтобы понять, как это работает, снова запустите tmux командой
```console
$ tmux
```
После этого, внутри tmux нажмите {bdg-dark}`Ctrl`-{bdg-dark}`b`, а затем --- {bdg-dark}`t`.
На экране появятся большие часы:

:::{figure-md} tmux_basic_030
<img src="./images/tmux_basic_030.svg" alt="Часы в окне tmux">

Часы в окне tmux
:::

Нажмите клавишу {bdg-dark}`Enter` или {bdg-dark}`Esc`, чтобы закрыть часы, и выйдите из tmux, набрав `exit`.

Так как сочетание {bdg-dark}`Ctrl`-{bdg-dark}`b` набирать достаточно не удобно, разумным решением является назначить для
префикса более простую комбинацию.
Как это сделать будет показано в разделе {ref}`«Настройка tmux»<tmux_configuring>`.
Поэтому в дальнейшем изложении вместо {bdg-dark}`Ctrl`-{bdg-dark}`b` будем использовать обозначение {bdg-dark}`PREFIX`,
за которым следует горячая клавиша для команды tmux, например, {bdg-dark}`PREFIX` {bdg-dark}`t` для отображения часов,
или {bdg-dark}`PREFIX` {bdg-dark}`d` для отсоединения (detaching) от сеанса.

Теперь давайте посмотрим, как запустить программы в фоновом режиме.

+++

## Работа с сеансами

### Отсоединение от сеанса

Если закрыть обычный сеанс терминала, все программы, запущенные в этом сеансе, будут уничтожены.
Одной из отличительной особенностью и преимуществом tmux в данном случае является то, что после запуска программ или
процессов внутри него, можно оставить все это работающим в фоновом режиме, «отсоединившись» (detaching) от сеанса.
Когда пользователь отсоединяется от сеанса tmux, он на самом деле не закрываете его.
Любые программы, которые были запущены в этом сеансе будут продолжать работать в фоне.
Позже, когда возникнет необходимость, пользователь может «присоединиться» (attach) к сеансу и продолжить работу с того
места, на котором остановился.
Для демонстрации этого, давайте создадим новый именованный сеанс tmux, запустим программу и отсоединимся от сеанса.

Сначала создадим сеанс:
```console
$ tmux new -s first_session
```

Затем в сеансе tmux запустим приложение с именем `top`, которое отслеживает использование памяти и процессора:
```console
$ top
```

В терминале отобразится что-то похожее на следующий рисунок.
<!--
:::{figure-md} tmux_basic_040
<img src="./images/tmux_basic_040.svg" alt="Сеанс tmux с запущенной программой `top`">

Сеанс tmux с запущенной программой `top`
:::
-->
Теперь отключимся от сеанса tmux, нажав {bdg-dark}`PREFIX` {bdg-dark}`d`.
Это вернет обычный терминал.
Теперь давайте посмотрим, как вернуться к тому сеансу tmux, который мы оставили запущенным.
Но прежде чем мы это сделать, закроем окно терминала.

+++

### Повторное подключение к существующему сеансу

Мы создали сеанс tmux, запустили программу внутри сеанса, отсоединились от него и закрыли окно терминала, но сеанс
tmux все еще работает вместе с приложением, которое мы запустили.

Просмотреть список существующих сеансов tmux можно, используя команду
```console
$ tmux list-session
```
или ее сокращенный вариант
```console
$ tmux ls
```
в новом окне терминала.

Команда покажет, что в данный момент запущен один сеанс:
```console
first_session: 1 windows (created Thu Jan 01 22:20:00 2024)
```

Для подключения к существующему сеансу используется команда `attach`.
Так как у нас запущен только один сеанс, то, для присоединения к сеансу, можно использовать команду `attach` без
параметров
```console
$ tmux attach
```

Все становится сложнее, если будет запущено более одного сеанса.
Отключимся от основного сеанса с помощью {bdg-dark}`PREFIX` {bdg-dark}`d`.

Теперь создадим новый сеанс tmux в фоновом режиме, без присоединения к нему, с помощью команды
```console
$ tmux new -s second_session -d
```
После этого список запущенных сеансов будет выглядеть так
```console
$ tmux ls
```
```console
first_session: 1 windows (created Thu Jan 01 22:30:00 2024)
second_session: 1 windows (created Thu Jan 01 22:30:00 2024)
```
Подключиться к нужному сеансу, можно используя флаг `-t`, за которым следует имя сеанса.
Запустим следующую команду:
```console
$ tmux attach -t second_session
```

Это присоединит нас к сеансу tmux second_session.
Отсоединимся от этого сеанса, используя {bdg-dark}`PREFIX` {bdg-dark}`d`, а снова присоединимся к первому сеансу.

<!--
В разделе «Переключение между сеансами» главы 6 будут рассмотрены другие способы перемещения между активными сеансами.
-->

А пока давайте удалим активные сеансы.

+++

### Закрытие сеанса

Для закрытия активного сеанса достаточно ввести
```console
$ exit
```
внутри него.

Другой способ закрытия сеанса --- команда `kill-session`.
Ее использование аналогично `tmux attach`:
```console
$ tmux kill-session -t first_basic
```
```console
$ tmux kill-session -t second_session
```

Это может быть полезно в ситуациях, когда программа в сеансе зависла.

При попытке снова получить список сеансов
```console
$ tmux ls
```
получим следующее сообщение:
```console
no server running on /tmp/tmux-1000/default
```
Поскольку сеансы tmux не существуют, то и сам tmux не работает, а сдедовательно, он не может обработать запрос.

Теперь, после знакомства с основами создания сеансов и работы с ними, давайте посмотрим, как можно организовать
работу с несколькими программами в рамках одного сеанса.

+++

## Работа с окнами

В рамках одного сеанса tmux можно одновременно работать с несколькими приложениями. 
И это наиболее часто используемый способ работы c tmux.
Поддерживать порядок и организацию при этом можно с помощью окон, которые похожи на вкладки в современных эмуляторах 
графического терминала или веб-браузерах.
Каждый раз когда запускается новый сеанс, tmux создает начальное окно.

Давайте создадим новый сеанс с двумя окнами.
В первом окне будет обычный терминал, а во втором запустим команду `top`.

### Создание и наименование окон

Создажим именованный сеанс с именем «windows»:
```console
$ tmux new -s windows -n shell
```
Используя флаг `-n`, можно задать имя первого окна, чтобы можно было легко его идентифицировать.
Теперь давайте добавим еще одно окно в этот сеанс.

Чтобы создать окно в текущем сеансе, нажмите {bdg-dark}`PREFIX` {bdg-dark}`c`.
Такой способ создание приводит к автоматическому переключению фокуса на новое окно.
Давайте запустим `top` в этом новом окне.
```console
$ top
```
Первое окно имеет, заданное при его создании, имя «shell», второе --- «top».
Так как имя второго окна не было задано при создании, оно будет меняться в зависимости от запущенного в данный момент 
приложения.
Чтобы переименовать окно, достаточно нажать {bdg-dark}`PREFIX` {bdg-dark}`,` (запятая). 
После этого строка состояния изменится, позволяя переименовать текущее окно.
Переименуем его в «processes».

В рамках одного сеанса tmux можно создавать столько окон, сколько необходимо. 
Но как только их становится больше одного, нужно иметь возможность перемещаться между ними.

+++

### Перемещение между окнами

На данный момент вы создали два окна, и есть несколько способов перемещаться между ними.
Когда у вас только два окна, вы можете быстро перемещаться между ними с помощью `PREFIX` `n`, переключаясь на следующеее
окно (**n**ext window).
Так можно циклически перебрать окна, которые вы открыли.
Так как сейчас у вас есть только два окна такаой способ позволит просто переключается между ними.
Также можно использовать `PREFIX` `p` для перехода к предыдущему окну (**p**revious window).

По умолчанию каждое окно в tmux имеет номер, начинающийся с 0. Можно быстро перейти к первому окну
используя `PREFIX` `0`, ко второму --  `PREFIX` `1` .
Такая нумерация окон, начинающаяся с нуля, не всегда интуитивно понятна, но в Главе 2 «Настройка tmux», вы узнаете, как
сделать так, чтобы нумерация окон начиналась с единицы, а не с нуля.

Если у вас больше девяти окон, вы можете использовать `PREFIX` `w` для отображения визуального меню cо списком ваших
окон, чтобы выбрать то, которое необходимо в данный момент.

Еще можно использовать `PREFIX` `f` , чтобы найти окно, содержащее строку текста.
Если ввести текст и нажать клавишу `Enter`, отобразится список окон, содержащих этот текст.

Теперь вы можете продолжить создавать новые окна и запускать программы.
Когда вы отсоединитесь от своего сеанс и повторно подключить позже, все ваши окна будут там, где вы их оставили.

Чтобы закрыть окно, вы можете либо ввести `exit` в приглашение в окне, либо использовать `PREFIX` `&`, после чего
отобразится подтверждающее сообщение в строке состояния перед закрытием окна.
Если вы подтвердите закрытие, активным станет предудущее окно.
Чтобы полностью закрыть сеанс tmux, вы должны закрыть все окна в сеансе.

Создание окон — это здорово, но мы можем сделать tmux еще более полезным, разбив окно на панели.